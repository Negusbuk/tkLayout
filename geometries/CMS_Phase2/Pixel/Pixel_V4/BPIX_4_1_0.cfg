  Barrel PXB {
    @include ../Supports/SupportsBPIX_V0_1_4modules.cfg
    @include-std CMS_Phase2/Pixel/Conversions/flange_BPIX
    @include stations_BPIX_Service_Cylinder_near
    
    bigDelta 1.5
    zOverlap -0.2 // 200 um gap along the stave
    beamSpotCover false
    smallDelta 0 
    numLayers 4
    startZMode modulecenter
    //zError 70

    compressed false
    innerRadius 29
    outerRadius 160

    smallParity 1
    bigParity -1

    Layer 1 {
      // TODO: materials are plain WRONG here (no tilt taken into account)      
      
      @includestd CMS_Phase2/Pixel/Materials/module_BPIX_v2_L1_1x2_2500
      @includestd CMS_Phase2/Pixel/Materials/rod_BPIX_L1
      @includestd CMS_Phase2/Pixel/Resolutions/Barrel_25x100
      destination BPIX1
      // layerRotation 0.262
      
      ////////////////////////////
      /// TILTED PART GEOMETRY ///
      ////////////////////////////
      
      isTilted true
      isTiltedAuto true
      numModulesFlat 3          // Number of flat rings along Z+, central ring included
      numModulesTilted 5        // Number of tilted rings along Z+
      numRods 13

      Ring 1-3 {
        // Different module types goes in the flat part
        @include-std CMS_Phase2/Pixel/ModuleTypes/pixel_2_1x2_25x100
      }
      Ring 4-8 {
        @include-std CMS_Phase2/Pixel/ModuleTypes/pixel_2R_1x1_50x50
        ringInnerRadius 37.1
        ringOuterRadius 37.6
        tiltAngle 80.0
        theta_g 20.0
        zOverlap 5.0
      }  
    }
  
    Layer 2 {
      zError 70
      phiOverlap 0.60
      phiSegments 4
      @include-std CMS_Phase2/Pixel/ModuleTypes/pixel_2_1x2_25x100
      @includestd CMS_Phase2/Pixel/Materials/module_BPIX_v2_L2_1x2_2500
      @includestd CMS_Phase2/Pixel/Materials/rod_BPIX_L2
      @includestd CMS_Phase2/Pixel/Resolutions/Barrel_25x100
      destination BPIX2
      plotColor 7
      Ring 2,4 { plotColor 8 }
      layerRotation 0.112
      radiusMode fixed
      placeRadiusHint 69 
      numModules 5  // 3 on the right and 3 on the left and a central one
    }
    Layer 3 {
      zError 70
      phiOverlap 0.60
      phiSegments 4
      @include-std CMS_Phase2/Pixel/ModuleTypes/pixel_2_2x2_25x100
      @includestd CMS_Phase2/Pixel/Materials/module_BPIX_v2_L3_2x2_2500
      @includestd CMS_Phase2/Pixel/Materials/rod_BPIX_L3
      @includestd CMS_Phase2/Pixel/Resolutions/Barrel_25x100
      destination BPIX3
      plotColor 7
      Ring 2,4 { plotColor 8 }
      layerRotation 0.131
      radiusMode fixed
      placeRadiusHint 120
      numModules 5  // 3 on the right and 3 on the left and a central one
    }
    Layer 4 {
      zError 70
      phiOverlap 0.60
      phiSegments 4
      @include-std CMS_Phase2/Pixel/ModuleTypes/pixel_2_2x2_25x100
      @includestd CMS_Phase2/Pixel/Materials/module_BPIX_v2_L4_2x2_2500
      @includestd CMS_Phase2/Pixel/Materials/rod_BPIX_L4
      @includestd CMS_Phase2/Pixel/Resolutions/Barrel_25x100
      destination BPIX4
      plotColor 7
      Ring 2,4 { plotColor 8 }
      layerRotation 0.098
      numModules 5  // 3 on the right and 3 on the left and a central one
    }
  }
